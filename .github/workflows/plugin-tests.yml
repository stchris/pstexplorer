name: Datasette plugin tests

on: [push, pull_request]

jobs:
  lint:
    name: Ruff lint & format
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v5
      - run: uvx ruff check plugins/ tests/
      - run: uvx ruff format --check plugins/ tests/

  integration:
    name: Playwright integration tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v5

      - name: Install Playwright browsers
        run: uv run --with playwright python -m playwright install --with-deps chromium

      - name: Run integration tests
        run: >
          uv run
          --with datasette
          --with pytest
          --with pytest-playwright
          pytest tests/test_email_view.py -v
